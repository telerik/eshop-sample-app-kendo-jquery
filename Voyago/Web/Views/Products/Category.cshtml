@{
	ViewData["Title"] = ViewBag.SubCategory;
}

<div class="category-page-container">
	<nav id="breadcrumb" name="breadcrumb"></nav>
	    @await Html.PartialAsync("_ListViewHeader.cshtml")

	<div class="category-content-container">
		@await Html.PartialAsync("_MainControls.cshtml")		
		<div id="allProductsListView" name="allProductsListView"></div>
	</div>
</div>

<script type="text/html" id="product-template">	
	@await Html.PartialAsync("_TileProductCard.cshtml")	
</script>

<script type="text/html" id="product-template-list">	
	@await Html.PartialAsync("_TileProductCardList.cshtml")	
</script>

<span hidden id="subCategory">@ViewBag.SubCategory</span>

<script>
	$(document).ready(function () {
		var searchParam = '@ViewBag.SearchParam';
		if (searchParam != null) {
			$("#searchBar").data("kendoAutoComplete").value(searchParam);
		}		

		$.get("/Products/GetAllModelsInSubCategory?subCategory=@ViewBag.SubCategory", function (data) {
			if (data.length == 0) {
				$("#modelPicker").parent().hide();
			}
			else {
				$("#modelPicker").kendoCheckBoxGroup({
					items: data,
					change: function (e) { filterDataSource(); }
				});
			}
		});

		$.get("/Products/GetAllSizesInSubCategory?subCategory=@ViewBag.SubCategory", function (data) {
			if(data.length == 0) {
				$("#sizePicker").parent().hide();
			}
			else {
				$("#sizePicker").kendoCheckBoxGroup({
					items: data,
					change: function (e) { filterDataSource(); }
				});
			}			
		});

		$.get("/Products/GetAllColorsInSubCategory?subCategory=@ViewBag.SubCategory", function (data) {
			if (data.length == 0) {
				$("#colorPicker").parent().hide();
			}
			else {
				$("#colorPicker").kendoCheckBoxGroup({
					items: data,
					change: function (e) { filterDataSource(); }
				});
			}			
		});

		$("#breadcrumb").kendoBreadcrumb({
			"items": [{
			    "href": "/Home/Index",
			    "icon": "home",
			    "showIcon": true,
			    "showText": false,
			    "type": "rootItem"
			}, {
			    "href": "/Home/@ViewBag.Category",
			    "text": "@ViewBag.Category",
			    "showText": true,
			    "type": "item"
			}, {
			    "href": "/Products/Category?subCategory=@ViewBag.SubCategory",
			    "text": "@ViewBag.SubCategory",
			    "showText": true,
			    "type": "item"
			}],
        "navigational": true
		});

		var dataSourceProducts = new kendo.data.DataSource({
		  transport: {	   
		    read: {
		      url: "/Products/ReadAllProducts",
		      dataType: "json" 
		    }
		  },
		  "filter": [{
               "logic": "and",
               "filters": [{
                   "field": "SubCategory",
                   "operator": "eq",
                   "value": "@ViewBag.SubCategory"
               }]
           }],
		});	
					
			$("#allProductsListView").kendoListView({
				"tagName": "div",				
				"dataSource": dataSourceProducts,			
				"template": kendo.template($('#product-template').html()),
				dataBound: onCategoryDataBound
			});

		 $('.toggle-view').kendoButtonGroup({
            items: [
                { icon: 'group' },
                { icon: 'list-bulleted' }
            ],
        });

		 let toggleButton = $('.toggle-view').kendoButtonGroup().data("kendoButtonGroup");
        
        toggleButton.select(0);
        
        toggleButton.bind("select", function(e) {
            let index = this.current().index();

            if(index === 0){
                let productsListView = $("#allProductsListView").data("kendoListView");

                productsListView.setOptions({
                    dataSource: {
                        pageSize: 12
                    },
                    template: kendo.template($("#product-template").html()),
                    layout: "grid",
                    grid: {
                        rows: 4,
                        cols: 3
                    },
                });

                productsListView.dataSource.pageSize(12);
            }
            else{
                let productsListView = $("#allProductsListView").data("kendoListView");
				debugger;
                productsListView.setOptions({
                    template: kendo.template($("#product-template-list").html()),
                    layout: "grid",
					dataSource: {
                        pageSize: 10
                    },
                    grid: {
                        rows: 5,
                        cols: 1
                    }
                });
                productsListView.dataSource.pageSize(5);
            }
        });
});
</script>

<style>
	#breadcrumb {
		margin-left: 30px;
	}

	.category-page-container {
		margin-top: 35px;
		margin: auto;
		width: 1500px;
	}

	.category-content-container {
		display: flex;
		flex-direction: row;
	}

	

<style>
	.favorites-container {
		display: flex;
		flex-direction: column;
		align-items: center;
	}

	.favorites-heading {
		margin-top: 56px;
		font-weight: 500;
		font-size: 40px;
		line-height: 58px;
		text-align: center;
		letter-spacing: -0.9px;
		color: #272727;
	}

	.continue-shopping {
		font-weight: 500;
		font-size: 20px;
		line-height: 24px;
		text-align: center;
		color: #0078D4;
		margin-top: 31px;
		margin-bottom: 53px;
	}

	a {
		text-decoration: none;
	}


	#favoritesListView {
		border: none;
		background: none;
	}

	.k-listview-content {
		justify-content: center;
		width: 1118px;
		margin-bottom: 48px;
	}

	.favorite-product-container {
		margin-top: 24px;
		margin-bottom: 24px;
		margin-left: 24px;
		margin-right: 24px;
		padding: 24px;
		width: 1070px;
		height: 320px;
		background: #FFFFFF;
		box-shadow: 0px 4px 24px rgba(123, 123, 123, 0.15);
		border-radius: 10px;
		display: flex;
		flex-direction: row;
	}

	.favorite-product-info-container {
		margin-left: 41px;
		margin-right: 182px;
		display: flex;
		flex-direction: column;
	}

	.favorite-product-controls {
		display: flex;
		flex-direction: column;
		justify-self: right;
	}

	.favorite-product-name {
		font-weight: 500;
		font-size: 26px;
		line-height: 46px;
		letter-spacing: -0.9px;
		color: #1D252C;
	}

	.avg-rating {
		display: flex;
		flex-direction: row;
	}

	.rating-text {
		font-weight: 500;
		font-size: 16px;
		line-height: 28px;
		letter-spacing: -0.9px;
		color: #1D252C;
		margin-left: 5px;
	}

	.favorite-product-description {
		text-align: left;
		font-weight: 400;
		font-size: 16px;
		line-height: 24px;
		color: #1D252C;
	}

	.price {
		text-align: right;
		font-weight: 500;
		font-size: 26px;
		line-height: 46px;
		letter-spacing: -0.9px;
		color: #0078D4;
		margin-bottom: 30px;
	}

	.cart-button {
		width: 250px;
		height: 40px;
		background: #0078D4;
		border-radius: 4px;
		margin-bottom: 16px;
		color: #FFFFFF !important;
	}

	 .card-cart-button:hover {
        background: white;
        color: #0078D4 !important;
        border-color: #0078D4 !important;
    }

	.favorites-button {
		width: 250px;
		height: 40px;
		background: #FFFFFF;
		border: 1px solid #272727;
		border-radius: 4px;
	}


	.k-button-text {
		font-weight: 500 !important;
		font-size: 16px !important;
		line-height: 24px !important;
		text-align: center !important;
	}
</style>
<link rel="stylesheet" href="/css/all_products_list_view.css">